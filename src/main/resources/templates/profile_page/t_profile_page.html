<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <title>Your profile</title>
    <link rel="stylesheet" href="/css/picnic/picnic.min.css">
    <link rel="stylesheet" href="/css/pages/profile_page/page.css">
</head>
<body>
<nav class="demo">
    <a href="#" class="brand">
        <span>Your profile page</span>
    </a>

    <div class="menu">
        <a href="#" class="pseudo button icon-picture">Logout</a>
        <a href="#" class="button icon-puzzle">SignIn</a>
    </div>
</nav>

<main>
    <h2 th:inline="text">Welcome to your profile, [[${user.name}]]!</h2>
    <article class="flex two">
        <section id="profile_info">
            <div style="width: 200px"> <!-- this div just for demo display -->
                <label class="dropimage profile_pic">
                    <input name="filea" title="Drop image or click me" type="file">
                </label>
            </div>
        </section>
        <section id="change_password">
            <h2>Change password</h2>
            <form id="change_password_form"
                  action="/Account/ChangePassword"
                  th:object="${changePasswordDto}"
                  method="post">
                <section>
                    <input class="stack"
                           placeholder="Old password"
                           type="password"
                           th:field="*{oldPassword}"
                           id="oldPassword">
                    <input class="stack"
                           placeholder="New Password"
                           type="password"
                           th:field="*{newPassword}"
                           id="newPassword">
                    <input class="stack"
                           placeholder="Confirm Password"
                           type="password"
                           th:field="*{newPasswordCf}"
                           id="newPasswordCf">
                </section>

                <div class="alert"
                     th:errors="*"
                     th:if="${#fields.hasErrors('*')}">
                    New Password Error
                </div>
                <div class="successMessage"
                     th:if="${changePasswordSuccess}"
                     th:text="${changePasswordSuccess}"></div>
                <footer>
                    <button type="submit">Change Password</button>
                </footer>
            </form>
        </section>
    </article>
    <section>
        <table class="primary">
            <thead>
            <tr><th>Skills</th></tr>
            <tr>
                <th>Skill</th>
                <th>Description</th>
                <th>Level of confidence</th>
                <th>Category</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </section>
</main>
</body>
<script src="/js/jquery-3.4.1.min.js"></script>
<script th:inline="javascript">
    /*<![CDATA[*/

    const imgUrl = /*[[${user.profileUrl}]]*/ 'none';
    /*]]>*/
</script>

<script src="/js/profile_page/profile_page.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        [].forEach.call(document.querySelectorAll('.dropimage'), function(img){
            img.style['background-image'] = 'url('+imgUrl+')';

            img.onchange = function(e){
                let inputfile = this, reader = new FileReader();
                reader.onloadend = function(){

                    let formData = new FormData(),
                        file = e.target.files[0],
                        xhr = new XMLHttpRequest();

                    formData.set('imgFile', file);

                    xhr.open('POST', '/api/Account/ChangePicture');
                    xhr.send(formData);

                    inputfile.style['background-image'] = 'url('+reader.result+')';
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });
    });
</script>
</html>